<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>FRIFRI ¬∑ Financiamiento Inteligente</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --primary-light: #60a5fa;
      --secondary: #1e293b;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --info: #06b6d4;
      --accent: #8b5cf6;
      --bg: #0f172a;
      --card-bg: #1e293b;
      --text: #ffffff;
      --text-secondary: #e2e8f0;
      --text-muted: #94a3b8;
      --border: #334155;
      --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.4);
      --shadow-lg: 0 20px 25px -5px rgb(0 0 0 / 0.5);
      --gradient-primary: linear-gradient(135deg, #3b82f6, #8b5cf6);
      --gradient-accent: linear-gradient(135deg, #06b6d4, #3b82f6);
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      transition: all 0.3s ease;
      width: 739px;
      height: 885px;
      overflow: hidden;
      margin: 0 auto;
      border: 1px solid var(--border);
      position: relative;
    }

    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at 20% 80%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                  radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    .content-wrapper {
      position: relative;
      z-index: 1;
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    /* Iconos SVG integrados */
    .icon {
      width: 16px;
      height: 16px;
      fill: currentColor;
      display: inline-block;
      vertical-align: middle;
    }

    .icon-lg {
      width: 20px;
      height: 20px;
    }

    .icon-xl {
      width: 24px;
      height: 24px;
    }

    header {
      background: var(--card-bg);
      padding: 0.75rem 1rem;
      box-shadow: var(--shadow);
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
      height: 60px;
      backdrop-filter: blur(10px);
    }

    header h1 {
      color: var(--text);
      font-size: 1.5rem;
      font-weight: 800;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      text-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
      letter-spacing: -0.025em;
    }

    header h1 .logo-text {
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header-actions {
      display: flex;
      gap: 0.25rem;
    }

    .connection-status {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--danger);
      animation: pulse 2s infinite;
    }

    .status-dot.online {
      background: var(--success);
      animation: none;
    }

    .status-dot.syncing {
      background: var(--warning);
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .btn-primary, .btn-secondary, .btn-success, .btn-danger, .btn-warning, .btn-info, .btn-close {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    .btn-primary::before, .btn-secondary::before, .btn-success::before, 
    .btn-danger::before, .btn-warning::before, .btn-info::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    .btn-primary:hover::before, .btn-secondary:hover::before, .btn-success:hover::before,
    .btn-danger:hover::before, .btn-warning:hover::before, .btn-info:hover::before {
      left: 100%;
    }

    .btn-primary {
      background: var(--gradient-primary);
      color: white;
      font-weight: 700;
      box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
    }

    .btn-primary:active {
      transform: translateY(0) scale(0.98);
    }

    .btn-secondary {
      background: var(--card-bg);
      color: var(--text);
      border: 1px solid var(--border);
      box-shadow: 0 4px 15px rgba(30, 41, 59, 0.3);
    }

    .btn-secondary:hover {
      background: var(--secondary);
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 8px 25px rgba(30, 41, 59, 0.4);
    }

    .btn-secondary:active {
      transform: translateY(0) scale(0.98);
    }

    .btn-success {
      background: linear-gradient(135deg, var(--success), #059669);
      color: white;
      box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    }

    .btn-success:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
    }

    .btn-success:active {
      transform: translateY(0) scale(0.98);
    }

    .btn-danger {
      background: linear-gradient(135deg, var(--danger), #dc2626);
      color: white;
      box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
    }

    .btn-danger:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
    }

    .btn-danger:active {
      transform: translateY(0) scale(0.98);
    }

    .btn-warning {
      background: linear-gradient(135deg, var(--warning), #d97706);
      color: white;
      box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
    }

    .btn-warning:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
    }

    .btn-warning:active {
      transform: translateY(0) scale(0.98);
    }

    .btn-info {
      background: var(--gradient-accent);
      color: white;
      box-shadow: 0 4px 15px rgba(6, 182, 212, 0.3);
    }

    .btn-info:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 8px 25px rgba(6, 182, 212, 0.4);
    }

    .btn-info:active {
      transform: translateY(0) scale(0.98);
    }

    .btn-close {
      background: var(--danger);
      color: white;
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      padding: 0.25rem;
      border-radius: 0.25rem;
    }

    main {
      padding: 1rem;
      height: calc(885px - 60px);
      overflow-y: auto;
      flex: 1;
    }

    /* Capital Management */
    .capital-section {
      background: var(--gradient-primary);
      color: white;
      padding: 1.5rem;
      border-radius: 1rem;
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
    }

    .capital-section::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: float 6s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-10px) rotate(180deg); }
    }

    /* QR Section */
    .qr-section {
      background: var(--gradient-accent);
      color: white;
      padding: 1.5rem;
      border-radius: 1rem;
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow-lg);
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .qr-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
      0% { left: -100%; }
      100% { left: 100%; }
    }

    .qr-container {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    .qr-code {
      background: white;
      padding: 1rem;
      border-radius: 0.75rem;
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
      transition: transform 0.3s ease;
    }

    .qr-code:hover {
      transform: scale(1.05);
    }

    .qr-info {
      flex: 1;
      min-width: 200px;
    }

    .qr-info h3 {
      font-size: 1.25rem;
      margin-bottom: 0.5rem;
      font-weight: 700;
    }

    .qr-info p {
      opacity: 0.9;
      line-height: 1.6;
    }

    .connection-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(255,255,255,0.2);
      padding: 0.5rem 1rem;
      border-radius: 2rem;
      font-size: 0.875rem;
      font-weight: 600;
      margin-top: 1rem;
      backdrop-filter: blur(10px);
    }

    .sync-status {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
      padding: 0.25rem 0.75rem;
      border-radius: 1rem;
      font-size: 0.75rem;
      font-weight: 600;
      margin-left: 0.5rem;
    }

    .sync-status.syncing {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning);
    }

    .sync-status.error {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
    }

    .capital-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
      margin-top: 0.75rem;
    }

    .capital-item {
      background: rgba(255, 255, 255, 0.1);
      padding: 0.75rem;
      border-radius: 0.375rem;
      backdrop-filter: blur(10px);
      text-align: center;
    }

    .capital-item h4 {
      font-size: 0.75rem;
      opacity: 0.9;
      margin-bottom: 0.25rem;
    }

    .capital-item p {
      font-size: 1rem;
      font-weight: 700;
    }

    .cards {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .card {
      background: var(--card-bg);
      padding: 1.5rem;
      border-radius: 1rem;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--gradient-primary);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }

    .card:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: var(--shadow-lg);
      border-color: var(--primary);
    }

    .card:hover::before {
      transform: scaleX(1);
    }

    .card h3 {
      color: var(--text-muted);
      font-size: 0.75rem;
      font-weight: 500;
      margin-bottom: 0.375rem;
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }

    .card p {
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--text);
    }

    .filters {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
      flex-wrap: wrap;
    }

    .filters input, .filters select {
      padding: 0.5rem;
      border: 1px solid var(--border);
      border-radius: 0.375rem;
      background: var(--card-bg);
      color: var(--text);
      flex: 1;
      min-width: 120px;
      font-size: 0.75rem;
    }

    .filters input:focus, .filters select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .cliente-item {
      background: var(--card-bg);
      padding: 1rem;
      border-radius: 0.5rem;
      margin-bottom: 0.75rem;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      transition: all 0.2s ease;
      cursor: pointer;
    }

    .cliente-item:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-lg);
      border-color: var(--primary);
    }

    .cliente-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.75rem;
    }

    .cliente-info h4 {
      font-size: 1rem;
      margin-bottom: 0.25rem;
      color: var(--text);
    }

    .cliente-info p {
      color: var(--text-muted);
      font-size: 0.75rem;
      margin-bottom: 0.125rem;
    }

    .cliente-actions {
      display: flex;
      gap: 0.25rem;
      flex-wrap: wrap;
    }

    .cliente-status {
      padding: 0.25rem 0.5rem;
      border-radius: 0.75rem;
      font-size: 0.625rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .status-pendiente {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning);
    }

    .status-pagado {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
    }

    .status-vencido {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
    }

    /* Modal Cliente Detalle */
    .modal-detalle {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(4px);
    }

    .modal-detalle-content {
      background: var(--card-bg);
      border-radius: 1rem;
      width: 90%;
      max-width: 600px;
      height: 90%;
      position: relative;
      box-shadow: var(--shadow-lg);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      border: 1px solid var(--border);
    }

    .modal-detalle-header {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--gradient-primary);
      color: white;
    }

    .modal-detalle-header h2 {
      font-size: 1.125rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .modal-detalle-body {
      flex: 1;
      overflow-y: auto;
      padding: 0;
    }

    .detalle-tabs {
      display: flex;
      background: var(--bg);
      border-bottom: 1px solid var(--border);
    }

    .detalle-tab {
      flex: 1;
      padding: 0.75rem;
      border: none;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.375rem;
    }

    .detalle-tab.active {
      background: var(--card-bg);
      color: var(--text);
      border-bottom: 2px solid var(--primary);
    }

    .detalle-panel {
      padding: 1rem;
      display: none;
    }

    .detalle-panel.active {
      display: block;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .info-item {
      background: var(--bg);
      padding: 0.75rem;
      border-radius: 0.375rem;
      border: 1px solid var(--border);
    }

    .info-item .label {
      font-size: 0.625rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.25rem;
    }

    .info-item .value {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text);
    }

    .progress-section {
      margin-bottom: 1rem;
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      background: var(--border);
      border-radius: 3px;
      overflow: hidden;
      margin-top: 0.5rem;
    }

    .progress-fill {
      height: 100%;
      background: var(--gradient-primary);
      transition: width 0.3s ease;
    }

    .cuotas-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 0.5rem;
    }

    .cuota-card {
      padding: 0.5rem;
      border: 1px solid var(--border);
      border-radius: 0.375rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.625rem;
      background: var(--card-bg);
    }

    .cuota-card.pagada {
      background: var(--success);
      color: white;
      border-color: var(--success);
    }

    .cuota-card.pendiente {
      background: var(--card-bg);
      color: var(--text-muted);
    }

    .cuota-card.proxima {
      background: var(--warning);
      color: white;
      border-color: var(--warning);
      animation: pulse 2s infinite;
    }

    .cuota-card.vencida {
      background: var(--danger);
      color: white;
      border-color: var(--danger);
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .chart-container {
      position: relative;
      height: 200px;
      margin: 1rem 0;
    }

    .calendar-mini {
      background: var(--bg);
      border-radius: 0.5rem;
      padding: 0.75rem;
      border: 1px solid var(--border);
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 0.25rem;
    }

    .calendar-day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.625rem;
      border-radius: 0.25rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .calendar-day.header {
      font-weight: 600;
      color: var(--text-muted);
      cursor: default;
    }

    .calendar-day.today {
      background: var(--primary);
      color: white;
    }

    .calendar-day.has-payment {
      background: var(--success);
      color: white;
    }

    .calendar-day.has-due {
      background: var(--danger);
      color: white;
    }

    .form-edit {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--text-muted);
      margin-bottom: 0.375rem;
    }

    .form-group input, .form-group select {
      padding: 0.5rem;
      border: 1px solid var(--border);
      border-radius: 0.375rem;
      background: var(--bg);
      color: var(--text);
      transition: border-color 0.2s ease;
      font-size: 0.75rem;
    }

    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(4px);
    }

    .modal-content {
      background: var(--card-bg);
      padding: 1.5rem;
      border-radius: 0.75rem;
      width: 90%;
      max-width: 500px;
      position: relative;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--border);
    }

    .modal-content h2 {
      margin-bottom: 1rem;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1.125rem;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }

    .calculation-preview {
      background: var(--bg);
      padding: 0.75rem;
      border-radius: 0.375rem;
      margin: 0.75rem 0;
      border: 1px solid var(--border);
    }

    .calculation-preview h4 {
      color: var(--text);
      margin-bottom: 0.5rem;
      font-size: 0.875rem;
    }

    .calc-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.25rem;
      font-size: 0.75rem;
    }

    .calc-row.total {
      font-weight: 600;
      border-top: 1px solid var(--border);
      padding-top: 0.5rem;
      margin-top: 0.5rem;
      color: var(--text);
    }

    .oculto {
      display: none !important;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 0.75rem 1rem;
      background: var(--success);
      color: white;
      border-radius: 0.375rem;
      box-shadow: var(--shadow-lg);
      z-index: 1001;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      font-size: 0.75rem;
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.error {
      background: var(--danger);
    }

    .notification.warning {
      background: var(--warning);
    }

    .notification.info {
      background: var(--info);
    }

    .share-section {
      background: var(--bg);
      padding: 1rem;
      border-radius: 0.5rem;
      border: 1px solid var(--border);
      margin-top: 1rem;
    }

    .share-link {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .share-link input {
      flex: 1;
      padding: 0.5rem;
      border: 1px solid var(--border);
      border-radius: 0.375rem;
      background: var(--card-bg);
      color: var(--text);
      font-size: 0.75rem;
    }

    .auto-save-indicator {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--success);
      color: white;
      padding: 0.5rem 0.75rem;
      border-radius: 0.375rem;
      font-size: 0.625rem;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .auto-save-indicator.show {
      opacity: 1;
    }

    .firebase-status {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(59, 130, 246, 0.2);
      color: var(--primary);
      padding: 0.25rem 0.75rem;
      border-radius: 1rem;
      font-size: 0.75rem;
      font-weight: 600;
      margin-left: 0.5rem;
    }

    .firebase-status.connected {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success);
    }

    .firebase-status.error {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
    }

    @media (max-width: 739px) {
      body {
        width: 100%;
        height: 100vh;
        border: none;
      }

      .capital-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .cards {
        grid-template-columns: repeat(2, 1fr);
      }

      .form-grid, .form-edit, .info-grid {
        grid-template-columns: 1fr;
      }

      .modal-detalle-content {
        width: 95%;
        height: 95%;
      }
    }
  </style>
</head>

<body>
  <div class="content-wrapper">
    <header>
      <h1>
        <svg class="icon icon-lg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z"/>
        </svg>
        <span class="logo-text">FRIFRI</span>
      </h1>
      <div class="header-actions">
        <div class="connection-status">
          <div class="status-dot" id="connectionDot"></div>
          <span id="connectionText">Offline</span>
          <div class="firebase-status" id="firebaseStatus">
            <div class="status-dot" id="firebaseDot"></div>
            <span id="firebaseText">Conectando...</span>
          </div>
        </div>
        <button id="btnReporteGanancias" class="btn-success">
          <svg class="icon" viewBox="0 0 24 24">
            <path d="M16,6L18.29,8.29L13.41,13.17L9.41,9.17L2,16.59L3.41,18L9.41,12L13.41,16L19.71,9.71L22,12V6H16Z"/>
          </svg>
          Ganancias
        </button>
        <button id="btnReporteGastos" class="btn-warning">
          <svg class="icon" viewBox="0 0 24 24">
            <path d="M16,18L18.29,15.71L13.41,10.83L9.41,14.83L2,7.41L3.41,6L9.41,12L13.41,8L19.71,14.29L22,12V18H16Z"/>
          </svg>
          Gastos
        </button>
        <button id="btnCapital" class="btn-info">
          <svg class="icon" viewBox="0 0 24 24">
            <path d="M11,8C11,9.66 9.66,11 8,11C6.34,11 5,9.66 5,8C5,6.34 6.34,5 8,5C9.66,5 11,6.34 11,8ZM14,20H2V18C2,15.79 4.69,14 8,14C11.31,14 14,15.79 14,18V20ZM22,12V14H13V12H22ZM22,8V10H13V8H22ZM22,4V6H13V4H22Z"/>
          </svg>
          Capital
        </button>
        <button id="btnShare" class="btn-secondary">
          <svg class="icon" viewBox="0 0 24 24">
            <path d="M18,16.08C17.24,16.08 16.56,16.38 16.04,16.85L8.91,12.7C8.96,12.47 9,12.24 9,12C9,11.76 8.96,11.53 8.91,11.3L15.96,7.19C16.5,7.69 17.21,8 18,8A3,3 0 0,0 21,5A3,3 0 0,0 18,2A3,3 0 0,0 15,5C15,5.24 15.04,5.47 15.09,5.7L8.04,9.81C7.5,9.31 6.79,9 6,9A3,3 0 0,0 3,12A3,3 0 0,0 6,15C6.79,15 7.5,14.69 8.04,14.19L15.16,18.34C15.11,18.55 15.08,18.77 15.08,19C15.08,20.61 16.39,21.91 18,21.91C19.61,21.91 20.92,20.6 20.92,19A2.92,2.92 0 0,0 18,16.08Z"/>
          </svg>
        </button>
        <button id="themeToggle" class="btn-secondary">
          <svg class="icon" viewBox="0 0 24 24">
            <path d="M12,8A4,4 0 0,0 8,12A4,4 0 0,0 12,16A4,4 0 0,0 16,12A4,4 0 0,0 12,8ZM12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18ZM20,8.69V4H15.31L12,0.69L8.69,4H4V8.69L0.69,12L4,15.31V20H8.69L12,23.31L15.31,20H20V15.31L23.31,12L20,8.69Z"/>
          </svg>
        </button>
        <button id="btnAgregar" class="btn-primary">
          <svg class="icon" viewBox="0 0 24 24">
            <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
          </svg>
          Agregar
        </button>
      </div>
    </header>

    <main>
      <!-- QR Code Section -->
      <section class="qr-section">
        <div class="qr-container">
          <div class="qr-code">
            <canvas id="qrCanvas" width="120" height="120"></canvas>
          </div>
          <div class="qr-info">
            <h3>üîó Supervisi√≥n en Tiempo Real</h3>
            <p>Tu jefa puede escanear este c√≥digo QR para ver todos los movimientos y cambios en tiempo real desde su tel√©fono.</p>
            <div class="connection-badge" id="qrStatus">
              <div class="status-dot" id="qrConnectionDot"></div>
              <span id="qrConnectionText">Generando enlace...</span>
            </div>
            <div class="sync-status" id="syncStatus">
              <div class="status-dot" id="syncDot"></div>
              <span id="syncText">Sincronizando...</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Capital Management -->
      <section class="capital-section">
        <h2>
          <svg class="icon icon-lg" viewBox="0 0 24 24">
            <path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/>
          </svg>
          Gesti√≥n de Capital
        </h2>
        <div class="capital-grid">
          <div class="capital-item">
            <h4>Capital Inicial</h4>
            <p id="capitalInicial">$0.00</p>
          </div>
          <div class="capital-item">
            <h4>Capital Invertido</h4>
            <p id="capitalInvertido">$0.00</p>
          </div>
          <div class="capital-item">
            <h4>Capital Disponible</h4>
            <p id="capitalDisponible">$0.00</p>
          </div>
          <div class="capital-item">
            <h4>Ganancia Total</h4>
            <p id="gananciaTotal">$0.00</p>
          </div>
        </div>
      </section>

      <!-- Dashboard -->
      <section id="dashboard" class="cards">
        <div class="card" id="cardTotalClientes" style="cursor: pointer;">
          <h3>
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M16,4C18.11,4 19.8,5.69 19.8,7.8C19.8,9.91 18.11,11.6 16,11.6C13.89,11.6 12.2,9.91 12.2,7.8C12.2,5.69 13.89,4 16,4ZM16,13.4C18.67,13.4 24,14.73 24,17.4V20H8V17.4C8,14.73 13.33,13.4 16,13.4ZM8.8,12C10.36,12 11.6,10.76 11.6,9.2C11.6,7.64 10.36,6.4 8.8,6.4C7.24,6.4 6,7.64 6,9.2C6,10.76 7.24,12 8.8,12ZM8.8,13.4C6.67,13.4 2.4,14.46 2.4,16.6V18.8H7.2V17.4C7.2,16.2 7.65,15.15 8.39,14.37C8.53,14.23 8.66,14.1 8.8,13.97C8.8,13.64 8.8,13.4 8.8,13.4Z"/>
            </svg>
            Total Clientes
          </h3>
          <p id="totalClientes">0</p>
        </div>
        <div class="card" id="cardPendientes" style="cursor: pointer;">
          <h3>
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2ZM12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4ZM12,6A6,6 0 0,1 18,12H16A4,4 0 0,0 12,8V6Z"/>
            </svg>
            Pendientes
          </h3>
          <p id="totalPendiente">$0.00</p>
        </div>
        <div class="card" id="cardPagados" style="cursor: pointer;">
          <h3>
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"/>
            </svg>
            Pagados
          </h3>
          <p id="totalPagado">$0.00</p>
        </div>
        <div class="card">
          <h3>
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1M17,12H12V17H17V12Z"/>
            </svg>
            Pr√≥xima Cuota
          </h3>
          <p id="proxCuota">‚Äì</p>
        </div>
      </section>

      <!-- Filtros -->
      <section class="filters">
        <input id="searchInput" placeholder="üîç Buscar clientes..." />
        <select id="filterEstado">
          <option value="all">Todos</option>
          <option value="pendiente">Pendientes</option>
          <option value="pagado">Pagados</option>
          <option value="vencido">Vencidos</option>
        </select>
      </section>

      <!-- Lista de Clientes -->
      <section id="listaClientes"></section>

      <!-- Modal Capital -->
      <section id="modalCapital" class="modal oculto">
        <div class="modal-content">
          <h2>
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M5,6H23V18H5V6ZM14,9A3,3 0 0,1 17,12A3,3 0 0,1 14,12A3,3 0 0,1 14,9Z"/>
            </svg>
            Gesti√≥n de Capital
          </h2>
          <div class="form-grid">
            <div class="form-group">
              <label>Capital Inicial ($)</label>
              <input id="inputCapitalInicial" type="number" step="0.01" placeholder="1000.00" />
            </div>
          </div>
          <div class="share-section">
            <h4>Compartir con Jefa</h4>
            <p>Cuando tengas WiFi, tu jefa podr√° ver todo en tiempo real:</p>
            <div class="share-link">
              <input id="shareUrl" readonly placeholder="Se generar√° autom√°ticamente con WiFi" />
              <button id="btnCopyLink" class="btn-secondary">Copiar</button>
            </div>
          </div>
          <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
            <button id="btnGuardarCapital" class="btn-success">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"/>
              </svg>
              Guardar
            </button>
            <button id="btnCerrarCapital" class="btn-secondary">Cancelar</button>
          </div>
          <button id="btnCerrarCapitalX" class="btn-close">
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
            </svg>
          </button>
        </div>
      </section>

      <!-- Modal Nuevo Cliente -->
      <section id="formularioCliente" class="modal oculto">
        <div class="modal-content">
          <h2>
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M15,14C12.33,14 7,15.33 7,18V20H23V18C23,15.33 17.67,14 15,14ZM6,10V7H4V10H1V12H4V15H6V12H9V10M15,12A4,4 0 0,0 19,8A4,4 0 0,0 15,4A4,4 0 0,0 11,8A4,4 0 0,0 15,12Z"/>
            </svg>
            <span id="tituloFormulario">Nuevo Cliente</span>
          </h2>
          <form id="clienteForm">
            <div class="form-grid">
              <div class="form-group">
                <label>Nombre Completo</label>
                <input name="nombre" placeholder="Juan P√©rez" required />
              </div>
              <div class="form-group">
                <label>C√©dula</label>
                <input name="cedula" placeholder="1234567890" required />
              </div>
              <div class="form-group">
                <label>Celular</label>
                <input name="celular" placeholder="+1234567890" required />
              </div>
              <div class="form-group">
                <label>Producto</label>
                <input name="producto" placeholder="iPhone 15" required />
              </div>
              <div class="form-group">
                <label>Costo del Producto ($)</label>
                <input name="monto" type="number" step="0.01" placeholder="100.00" required />
              </div>
              <div class="form-group">
                <label>Margen de Ganancia (%)</label>
                <input name="margen" type="number" step="0.01" placeholder="40" required />
              </div>
              <div class="form-group">
                <label>N√∫mero de Cuotas</label>
                <input name="cuotas" type="number" placeholder="10" required />
              </div>
              <div class="form-group">
                <label>Per√≠odo de Pago</label>
                <select name="periodo" required>
                  <option value="semanal">Semanal</option>
                  <option value="quincenal">Quincenal</option>
                </select>
              </div>
              <div class="form-group">
                <label>Fecha de Inicio</label>
                <input name="inicio" type="date" required />
              </div>
            </div>
            
            <div id="calculationPreview" class="calculation-preview oculto">
              <h4>Vista Previa del C√°lculo</h4>
              <div class="calc-row">
                <span>Costo del producto:</span>
                <span id="prevCosto">$0.00</span>
              </div>
              <div class="calc-row">
                <span>Margen de ganancia:</span>
                <span id="prevMargen">$0.00</span>
              </div>
              <div class="calc-row total">
                <span>Precio de venta:</span>
                <span id="prevTotal">$0.00</span>
              </div>
              <div class="calc-row">
                <span>Valor por cuota:</span>
                <span id="prevCuota">$0.00</span>
              </div>
            </div>
            
            <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
              <button type="submit" class="btn-success">
                <svg class="icon" viewBox="0 0 24 24">
                  <path d="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"/>
                </svg>
                <span id="textoBotonGuardar">Guardar Cliente</span>
              </button>
              <button type="button" id="btnCerrar" class="btn-secondary">Cancelar</button>
            </div>
          </form>
          <button id="btnCerrarX" class="btn-close">
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
            </svg>
          </button>
        </div>
      </section>

      <!-- Modal Detalle Cliente -->
      <section id="modalDetalleCliente" class="modal-detalle oculto">
        <div class="modal-detalle-content">
          <div class="modal-detalle-header">
            <h2>
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4ZM12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"/>
              </svg>
              <span id="nombreClienteDetalle">Cliente</span>
            </h2>
            <button id="btnCerrarDetalle" class="btn-close">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
              </svg>
            </button>
          </div>
          
          <div class="detalle-tabs">
            <button class="detalle-tab active" data-panel="info">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20ZM12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2ZM11,17H13V11H11V17Z"/>
              </svg>
              Info
            </button>
            <button class="detalle-tab" data-panel="financiero">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M5,6H23V18H5V6ZM14,9A3,3 0 0,1 17,12A3,3 0 0,1 14,12A3,3 0 0,1 14,9Z"/>
              </svg>
              Financiero
            </button>
            <button class="detalle-tab" data-panel="pagos">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3ZM19,19H5V5H19V19ZM17,12H7V10H17V12ZM15,16H9V14H15V16Z"/>
              </svg>
              Pagos
            </button>
            <button class="detalle-tab" data-panel="calendario">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1M17,12H12V17H17V12Z"/>
              </svg>
              Calendario
            </button>
          </div>

          <div class="modal-detalle-body">
            <!-- Panel Info -->
            <div id="panelInfo" class="detalle-panel active">
              <div class="info-grid">
                <div class="info-item">
                  <div class="label">Nombre</div>
                  <div class="value" id="detalleNombre">-</div>
                </div>
                <div class="info-item">
                  <div class="label">C√©dula</div>
                  <div class="value" id="detalleCedula">-</div>
                </div>
                <div class="info-item">
                  <div class="label">Celular</div>
                  <div class="value" id="detalleCelular">-</div>
                </div>
                <div class="info-item">
                  <div class="label">Producto</div>
                  <div class="value" id="detalleProducto">-</div>
                </div>
                <div class="info-item">
                  <div class="label">Fecha Inicio</div>
                  <div class="value" id="detalleFechaInicio">-</div>
                </div>
                <div class="info-item">
                  <div class="label">Estado</div>
                  <div class="value" id="detalleEstado">-</div>
                </div>
              </div>
              <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                <button id="btnEditarCliente" class="btn-warning">
                  <svg class="icon" viewBox="0 0 24 24">
                    <path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"/>
                  </svg>
                  Editar
                </button>
                <button id="btnEliminarCliente" class="btn-danger">
                  <svg class="icon" viewBox="0 0 24 24">
                    <path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/>
                  </svg>
                  Eliminar
                </button>
              </div>
            </div>

            <!-- Panel Financiero -->
            <div id="panelFinanciero" class="detalle-panel">
              <div class="info-grid">
                <div class="info-item">
                  <div class="label">Costo Producto</div>
                  <div class="value" id="detalleCosto">$0.00</div>
                </div>
                <div class="info-item">
                  <div class="label">Margen (%)</div>
                  <div class="value" id="detalleMargen">0%</div>
                </div>
                <div class="info-item">
                  <div class="label">Ganancia</div>
                  <div class="value" id="detalleGanancia">$0.00</div>
                </div>
                <div class="info-item">
                  <div class="label">Total Venta</div>
                  <div class="value" id="detalleTotal">$0.00</div>
                </div>
                <div class="info-item">
                  <div class="label">Valor Cuota</div>
                  <div class="value" id="detalleValorCuota">$0.00</div>
                </div>
                <div class="info-item">
                  <div class="label">Per√≠odo</div>
                  <div class="value" id="detallePeriodo">-</div>
                </div>
              </div>
              <div class="progress-section">
                <h4>Progreso de Pagos</h4>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                  <span id="detalleProgreso">0/0</span>
                  <span id="detallePorcentaje">0%</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" id="detalleProgressFill" style="width: 0%"></div>
                </div>
              </div>
            </div>

            <!-- Panel Pagos -->
            <div id="panelPagos" class="detalle-panel">
              <div id="cuotasGrid" class="cuotas-grid"></div>
            </div>

            <!-- Panel Calendario -->
            <div id="panelCalendario" class="detalle-panel">
              <div id="calendarioMini" class="calendar-mini"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- Modal Reporte Ganancias -->
      <section id="modalReporteGanancias" class="modal oculto">
        <div class="modal-content">
          <h2>
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M16,6L18.29,8.29L13.41,13.17L9.41,9.17L2,16.59L3.41,18L9.41,12L13.41,16L19.71,9.71L22,12V6H16Z"/>
            </svg>
            Reporte de Ganancias
          </h2>
          <div id="reporteGananciasContent"></div>
          <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
            <button id="btnCerrarReporteGanancias" class="btn-secondary">Cerrar</button>
          </div>
          <button id="btnCerrarReporteGananciasX" class="btn-close">
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
            </svg>
          </button>
        </div>
      </section>

      <!-- Modal Reporte Gastos -->
      <section id="modalReporteGastos" class="modal oculto">
        <div class="modal-content">
          <h2>
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M16,18L18.29,15.71L13.41,10.83L9.41,14.83L2,7.41L3.41,6L9.41,12L13.41,8L19.71,14.29L22,12V18H16Z"/>
            </svg>
            Reporte de Gastos
          </h2>
          <div id="reporteGastosContent"></div>
          <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
            <button id="btnCerrarReporteGastos" class="btn-secondary">Cerrar</button>
          </div>
          <button id="btnCerrarReporteGastosX" class="btn-close">
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
            </svg>
          </button>
        </div>
      </section>

      <!-- Modal Detalle Total Clientes -->
      <section id="modalDetalleTotalClientes" class="modal oculto">
        <div class="modal-content">
          <h2>
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M16,4C18.11,4 19.8,5.69 19.8,7.8C19.8,9.91 18.11,11.6 16,11.6C13.89,11.6 12.2,9.91 12.2,7.8C12.2,5.69 13.89,4 16,4ZM16,13.4C18.67,13.4 24,14.73 24,17.4V20H8V17.4C8,14.73 13.33,13.4 16,13.4Z"/>
            </svg>
            Detalle Total Clientes
          </h2>
          <div id="detalleTotalClientesContent"></div>
          <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
            <button id="btnCerrarDetalleTotalClientes" class="btn-secondary">Cerrar</button>
          </div>
          <button id="btnCerrarDetalleTotalClientesX" class="btn-close">
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
            </svg>
          </button>
        </div>
      </section>

      <!-- Modal Detalle Pendientes -->
      <section id="modalDetallePendientes" class="modal oculto">
        <div class="modal-content">
          <h2>
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2ZM12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4ZM12,6A6,6 0 0,1 18,12H16A4,4 0 0,0 12,8V6Z"/>
            </svg>
            Detalle Pendientes
          </h2>
          <div id="detallePendientesContent"></div>
          <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
            <button id="btnCerrarDetallePendientes" class="btn-secondary">Cerrar</button>
          </div>
          <button id="btnCerrarDetallePendientesX" class="btn-close">
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
            </svg>
          </button>
        </div>
      </section>

      <!-- Modal Detalle Pagados -->
      <section id="modalDetallePagados" class="modal oculto">
        <div class="modal-content">
          <h2>
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"/>
            </svg>
            Detalle Pagados
          </h2>
          <div id="detallePagadosContent"></div>
          <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
            <button id="btnCerrarDetallePagados" class="btn-secondary">Cerrar</button>
          </div>
          <button id="btnCerrarDetallePagadosX" class="btn-close">
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
            </svg>
          </button>
        </div>
      </section>

      <!-- Indicador de guardado autom√°tico -->
      <div id="autoSaveIndicator" class="auto-save-indicator">
        <svg class="icon" viewBox="0 0 24 24">
          <path d="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"/>
        </svg>
        Guardado autom√°ticamente
      </div>
    </main>
  </div>

  <!-- Supabase Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    // Configuraci√≥n de Supabase
    const supabaseUrl = 'https://iqxhcanzyfptyxqmadjg.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlxeGhjYW56eWZwdHl4cW1hZGpnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2ODI0NTksImV4cCI6MjA3MDI1ODQ1OX0.15_Pz5yO20jIqhuJYfC4_xNtKR6suHP14ukxgJ3ixFM';
    
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    // Variables globales para Supabase
    window.supabaseClient = supabase;
    window.supabaseConnected = false;
    window.syncInProgress = false;
    window.realtimeChannel = null;

    // Funci√≥n para actualizar estado de Supabase
    function updateSupabaseStatus(status, message) {
      const statusElement = document.getElementById('firebaseStatus');
      const dotElement = document.getElementById('firebaseDot');
      const textElement = document.getElementById('firebaseText');
      
      statusElement.className = `firebase-status ${status}`;
      textElement.textContent = message;
      
      if (status === 'connected') {
        dotElement.classList.add('online');
        dotElement.classList.remove('syncing');
        window.supabaseConnected = true;
      } else if (status === 'syncing') {
        dotElement.classList.add('syncing');
        dotElement.classList.remove('online');
      } else {
        dotElement.classList.remove('online', 'syncing');
        window.supabaseConnected = false;
      }
    }

    // Funci√≥n para sincronizar datos con Supabase
    window.syncToSupabase = async function(data) {
      if (!window.supabaseConnected || window.syncInProgress) return;
      
      try {
        window.syncInProgress = true;
        updateSupabaseStatus('syncing', 'Sincronizando...');
        
        // Upsert datos completos
        const { error } = await supabase
          .from('frifri_sessions')
          .upsert({
            session_id: window.shareId,
            empleada: 'Trabajadora FRIFRI',
            capital_data: data.capital,
            clientes_data: data.clientes,
            resumen_data: data.resumen,
            last_sync: new Date().toISOString(),
            timestamp: Date.now()
          });
        
        if (error) throw error;
        
        updateSupabaseStatus('connected', 'Sincronizado');
        console.log('‚úÖ Datos sincronizados con Supabase');
        
        // Actualizar estado de sincronizaci√≥n en la UI
        updateSyncStatus('synced', 'Datos sincronizados');
        
      } catch (error) {
        console.error('‚ùå Error sincronizando con Supabase:', error);
        updateSupabaseStatus('error', 'Error de conexi√≥n');
        updateSyncStatus('error', 'Error al sincronizar');
      } finally {
        window.syncInProgress = false;
      }
    };

    // Funci√≥n para cargar datos desde Supabase
    window.loadFromSupabase = async function() {
      if (!window.supabaseConnected) return null;
      
      try {
        const { data, error } = await supabase
          .from('frifri_sessions')
          .select('*')
          .eq('session_id', window.shareId)
          .single();
        
        if (error && error.code !== 'PGRST116') throw error;
        
        if (data) {
          console.log('üì• Datos cargados desde Supabase');
          return {
            capital: data.capital_data,
            clientes: data.clientes_data,
            resumen: data.resumen_data,
            timestamp: data.timestamp
          };
        }
        return null;
      } catch (error) {
        console.error('‚ùå Error cargando desde Supabase:', error);
        return null;
      }
    };

    // Configurar listener en tiempo real
    window.setupRealtimeListener = function() {
      if (!window.supabaseConnected || window.realtimeChannel) return;
      
      window.realtimeChannel = supabase
        .channel('frifri-realtime')
        .on('postgres_changes', {
          event: '*',
          schema: 'public',
          table: 'frifri_sessions',
          filter: `session_id=eq.${window.shareId}`
        }, payload => {
          if (!window.syncInProgress) {
            console.log('üîÑ Cambio detectado en tiempo real:', payload);
            
            if (payload.eventType === 'UPDATE' || payload.eventType === 'INSERT') {
              const data = payload.new;
              
              // Solo actualizar si los datos son m√°s recientes
              const localTimestamp = localStorage.getItem('frifri-last-update') || 0;
              if (data.timestamp > localTimestamp) {
                // Actualizar datos locales sin disparar nueva sincronizaci√≥n
                if (data.clientes_data) {
                  window.clientes = data.clientes_data;
                  localStorage.setItem('frifri-clientes', JSON.stringify(data.clientes_data));
                }
                if (data.capital_data) {
                  window.capital = data.capital_data;
                  localStorage.setItem('frifri-capital', JSON.stringify(data.capital_data));
                }
                
                localStorage.setItem('frifri-last-update', data.timestamp.toString());
                
                // Actualizar UI
                window.actualizarDashboard();
                window.actualizarCapital();
                window.renderizarClientes();
                
                window.mostrarNotificacion('üì± Datos actualizados en tiempo real', 'info');
              }
            }
          }
        })
        .subscribe((status) => {
          if (status === 'SUBSCRIBED') {
            console.log('üîÑ Suscrito a cambios en tiempo real');
          } else if (status === 'CHANNEL_ERROR') {
            console.error('‚ùå Error en canal tiempo real');
            updateSupabaseStatus('error', 'Error de conexi√≥n');
          }
        });
    };

    // Intentar conectar a Supabase
    async function initializeSupabase() {
      try {
        updateSupabaseStatus('syncing', 'Conectando...');
        
        // Probar conexi√≥n
        const { data, error } = await supabase
          .from('frifri_sessions')
          .select('session_id')
          .limit(1);
        
        if (error && error.code !== 'PGRST116') throw error;
        
        updateSupabaseStatus('connected', 'Conectado');
        console.log('üöÄ Supabase conectado exitosamente');
        
        // Configurar listener en tiempo real
        window.setupRealtimeListener();
        
        // Cargar datos existentes si hay conexi√≥n
        if (navigator.onLine) {
          const cloudData = await window.loadFromSupabase();
          if (cloudData && cloudData.clientes) {
            // Merge con datos locales si es necesario
            const localTimestamp = localStorage.getItem('frifri-last-update') || 0;
            if (cloudData.timestamp > localTimestamp) {
              window.clientes = cloudData.clientes;
              window.capital = cloudData.capital || window.capital;
              localStorage.setItem('frifri-clientes', JSON.stringify(cloudData.clientes));
              localStorage.setItem('frifri-capital', JSON.stringify(cloudData.capital));
              localStorage.setItem('frifri-last-update', cloudData.timestamp.toString());
              console.log('üì• Datos cargados desde la nube');
            }
          }
        }
        
      } catch (error) {
        console.error('‚ùå Error conectando Supabase:', error);
        updateSupabaseStatus('error', 'Sin conexi√≥n');
      }
    }

    // Inicializar cuando el DOM est√© listo
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(initializeSupabase, 1000);
    });
  </script>

  <script>
    // Estado de la aplicaci√≥n
    let clientes = JSON.parse(localStorage.getItem('frifri-clientes') || '[]');
    let capital = JSON.parse(localStorage.getItem('frifri-capital') || '{"inicial": 0, "invertido": 0}');
    let clienteEditando = null;
    let clienteDetalle = null;
    let isOnline = navigator.onLine;
    let shareId = localStorage.getItem('frifri-share-id') || generateShareId();
    let supervisorUrl = '';

    // Hacer variables globales para Firebase
    window.clientes = clientes;
    window.capital = capital;
    window.shareId = shareId;

    // Inicializaci√≥n
    document.addEventListener('DOMContentLoaded', function() {
      // Establecer fecha por defecto
      const hoy = new Date().toISOString().split('T')[0];
      document.querySelector('input[name="inicio"]').value = hoy;
      
      // Migrar datos antiguos si es necesario
      migrarDatos();
      
      actualizarDashboard();
      actualizarCapital();
      renderizarClientes();
      configurarEventos();
      configurarConexion();
      generarQR();
      
      // Configurar guardado autom√°tico
      configurarGuardadoAutomatico();
      
      // Configurar sincronizaci√≥n con Supabase cuando est√© disponible
      setTimeout(() => {
        if (window.supabaseConnected && isOnline) {
          sincronizarConSupabase();
        }
      }, 2000);
    });

    // Funci√≥n para actualizar estado de sincronizaci√≥n
    function updateSyncStatus(status, message) {
      const syncStatus = document.getElementById('syncStatus');
      const syncDot = document.getElementById('syncDot');
      const syncText = document.getElementById('syncText');
      
      syncStatus.className = `sync-status ${status}`;
      syncText.textContent = message;
      
      if (status === 'synced') {
        syncDot.classList.add('online');
        syncDot.classList.remove('syncing');
      } else if (status === 'syncing') {
        syncDot.classList.add('syncing');
        syncDot.classList.remove('online');
      } else {
        syncDot.classList.remove('online', 'syncing');
      }
    }

    // Funci√≥n para sincronizar con Supabase
    async function sincronizarConSupabase() {
      if (!window.supabaseConnected || !isOnline) {
        updateSyncStatus('error', 'Sin conexi√≥n');
        return;
      }
      
      try {
        updateSyncStatus('syncing', 'Sincronizando...');
        
        const datosCompletos = {
          id: shareId,
          empleada: 'Trabajadora FRIFRI',
          capital: capital,
          clientes: clientes,
          resumen: {
            totalClientes: clientes.length,
            capitalInvertido: capital.invertido,
            gananciasGeneradas: clientes
              .filter(c => c.estado === 'pagado')
              .reduce((sum, c) => sum + (c.montoTotal - c.monto), 0),
            cuotasPendientes: clientes.reduce((sum, c) => {
              const pendientes = c.cuotas - c.cuotasPagadas;
              return sum + (pendientes * c.valorCuota);
            }, 0)
          }
        };
        
        await window.syncToSupabase(datosCompletos);
        localStorage.setItem('frifri-last-update', Date.now().toString());
        
      } catch (error) {
        console.error('Error sincronizando:', error);
        updateSyncStatus('error', 'Error al sincronizar');
      }
    }

    // Migrar datos antiguos
    function migrarDatos() {
      let datosActualizados = false;
      
      clientes.forEach(cliente => {
        if (!cliente.cuotasDetalle) {
          cliente.fechasCuotas = generarFechasCuotas(cliente.inicio, cliente.cuotas, cliente.periodo);
          cliente.cuotasDetalle = cliente.fechasCuotas.map((fecha, index) => ({
            numero: index + 1,
            fecha: fecha,
            monto: cliente.valorCuota,
            pagada: index < cliente.cuotasPagadas,
            fechaPago: index < cliente.cuotasPagadas ? new Date().toISOString() : null
          }));
          datosActualizados = true;
        }
        
        if (!cliente.ganancia) {
          cliente.ganancia = cliente.monto * (cliente.margen / 100);
          datosActualizados = true;
        }

        if (!cliente.id) {
          cliente.id = Date.now() + Math.random();
          datosActualizados = true;
        }
      });

      if (datosActualizados) {
        guardarDatos();
      }
    }

    // Generar ID √∫nico para compartir
    function generateShareId() {
      const id = 'frifri-' + Math.random().toString(36).substr(2, 9);
      localStorage.setItem('frifri-share-id', id);
      return id;
    }

    // Generar QR Code
    function generarQR() {
      // Crear URL √∫nica para supervisi√≥n
      supervisorUrl = `https://frifri-supervisor.netlify.app/?id=${shareId}&name=FRIFRI-Supervision`;
      
      const canvas = document.getElementById('qrCanvas');
      const ctx = canvas.getContext('2d');
      
      // Limpiar canvas
      ctx.fillStyle = '#ffffff';
      ctx.fillRect(0, 0, 120, 120);
      
      // Generar patr√≥n QR simple (simulado)
      ctx.fillStyle = '#1f2937';
      const size = 4;
      const data = supervisorUrl;
      
      // Crear patr√≥n basado en la URL
      for (let i = 0; i < 30; i++) {
        for (let j = 0; j < 30; j++) {
          const hash = simpleHash(data + i + j);
          if (hash % 2 === 0) {
            ctx.fillRect(i * size, j * size, size, size);
          }
        }
      }
      
      // Esquinas de posicionamiento
      drawPositionMarker(ctx, 0, 0);
      drawPositionMarker(ctx, 104, 0);
      drawPositionMarker(ctx, 0, 104);
      
      actualizarEstadoQR();
    }

    // Hash simple para generar patr√≥n
    function simpleHash(str) {
      let hash = 0;
      for (let i = 0; i < str.length; i++) {
        const char = str.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash;
      }
      return Math.abs(hash);
    }

    // Dibujar marcadores de posici√≥n del QR
    function drawPositionMarker(ctx, x, y) {
      ctx.fillStyle = '#1f2937';
      ctx.fillRect(x, y, 16, 16);
      ctx.fillStyle = '#ffffff';
      ctx.fillRect(x + 2, y + 2, 12, 12);
      ctx.fillStyle = '#1f2937';
      ctx.fillRect(x + 4, y + 4, 8, 8);
    }

    // Actualizar estado del QR
    function actualizarEstadoQR() {
      const dot = document.getElementById('qrConnectionDot');
      const text = document.getElementById('qrConnectionText');
      
      if (isOnline && window.supabaseConnected) {
        dot.classList.add('online');
        text.textContent = 'Enlace activo - Listo para escanear';
      } else if (isOnline) {
        dot.classList.remove('online');
        text.textContent = 'Conectando a la nube...';
      } else {
        dot.classList.remove('online');
        text.textContent = 'Sin conexi√≥n - QR disponible offline';
      }
    }

    // Configurar conexi√≥n
    function configurarConexion() {
      actualizarEstadoConexion();
      
      window.addEventListener('online', () => {
        isOnline = true;
        actualizarEstadoConexion();
        actualizarEstadoQR();
        
        // Sincronizar cuando vuelva la conexi√≥n
        setTimeout(() => {
          if (window.supabaseConnected) {
            sincronizarConSupabase();
          }
        }, 1000);
      });
      
      window.addEventListener('offline', () => {
        isOnline = false;
        actualizarEstadoConexion();
        actualizarEstadoQR();
        updateSyncStatus('error', 'Sin conexi√≥n');
      });
    }

    // Actualizar estado de conexi√≥n
    function actualizarEstadoConexion() {
      const dot = document.getElementById('connectionDot');
      const text = document.getElementById('connectionText');
      
      if (isOnline) {
        dot.classList.add('online');
        text.textContent = 'Online';
      } else {
        dot.classList.remove('online');
        text.textContent = 'Offline';
      }
    }

    // Configurar guardado autom√°tico
    function configurarGuardadoAutomatico() {
      let timeoutId;
      
      const autoSave = () => {
        clearTimeout(timeoutId);
        timeoutId = setTimeout(() => {
          guardarDatos();
          mostrarIndicadorGuardado();
          
          // Sincronizar con Supabase si est√° disponible
          if (isOnline && window.supabaseConnected) {
            sincronizarConSupabase();
          }
        }, 1000);
      };

      // Observar cambios en los datos
      const observer = new MutationObserver(autoSave);
      observer.observe(document.body, { 
        childList: true, 
        subtree: true, 
        attributes: true 
      });
    }

    // Mostrar indicador de guardado
    function mostrarIndicadorGuardado() {
      const indicator = document.getElementById('autoSaveIndicator');
      indicator.classList.add('show');
      setTimeout(() => {
        indicator.classList.remove('show');
      }, 2000);
    }

    // Configurar eventos
    function configurarEventos() {
      // Botones principales
      document.getElementById('btnAgregar').addEventListener('click', () => {
        clienteEditando = null;
        document.getElementById('tituloFormulario').textContent = 'Nuevo Cliente';
        document.getElementById('textoBotonGuardar').textContent = 'Guardar Cliente';
        document.getElementById('formularioCliente').classList.remove('oculto');
      });

      document.getElementById('btnReporteGanancias').addEventListener('click', abrirReporteGanancias);
      document.getElementById('btnReporteGastos').addEventListener('click', abrirReporteGastos);

      document.getElementById('btnCapital').addEventListener('click', () => {
        document.getElementById('inputCapitalInicial').value = capital.inicial;
        document.getElementById('shareUrl').value = supervisorUrl;
        document.getElementById('modalCapital').classList.remove('oculto');
      });

      document.getElementById('btnShare').addEventListener('click', () => {
        if (isOnline && window.supabaseConnected) {
          sincronizarConSupabase();
          mostrarNotificacion('üîÑ Sincronizando datos con la nube...', 'info');
        } else if (isOnline) {
          mostrarNotificacion('‚è≥ Conectando a la base de datos...', 'warning');
        } else {
          mostrarNotificacion('üì∂ Necesitas conexi√≥n WiFi para compartir', 'warning');
        }
      });

      // Cerrar modales
      document.getElementById('btnCerrar').addEventListener('click', cerrarModalCliente);
      document.getElementById('btnCerrarX').addEventListener('click', cerrarModalCliente);
      document.getElementById('btnCerrarCapital').addEventListener('click', cerrarModalCapital);
      document.getElementById('btnCerrarCapitalX').addEventListener('click', cerrarModalCapital);
      document.getElementById('btnCerrarDetalle').addEventListener('click', cerrarModalDetalle);
      
      // Cerrar modales de reportes
      document.getElementById('btnCerrarReporteGanancias').addEventListener('click', () => {
        document.getElementById('modalReporteGanancias').classList.add('oculto');
      });
      document.getElementById('btnCerrarReporteGananciasX').addEventListener('click', () => {
        document.getElementById('modalReporteGanancias').classList.add('oculto');
      });
      document.getElementById('btnCerrarReporteGastos').addEventListener('click', () => {
        document.getElementById('modalReporteGastos').classList.add('oculto');
      });
      document.getElementById('btnCerrarReporteGastosX').addEventListener('click', () => {
        document.getElementById('modalReporteGastos').classList.add('oculto');
      });
      
      // Cerrar modales de detalles
      document.getElementById('btnCerrarDetalleTotalClientes').addEventListener('click', () => {
        document.getElementById('modalDetalleTotalClientes').classList.add('oculto');
      });
      document.getElementById('btnCerrarDetalleTotalClientesX').addEventListener('click', () => {
        document.getElementById('modalDetalleTotalClientes').classList.add('oculto');
      });
      document.getElementById('btnCerrarDetallePendientes').addEventListener('click', () => {
        document.getElementById('modalDetallePendientes').classList.add('oculto');
      });
      document.getElementById('btnCerrarDetallePendientesX').addEventListener('click', () => {
        document.getElementById('modalDetallePendientes').classList.add('oculto');
      });
      document.getElementById('btnCerrarDetallePagados').addEventListener('click', () => {
        document.getElementById('modalDetallePagados').classList.add('oculto');
      });
      document.getElementById('btnCerrarDetallePagadosX').addEventListener('click', () => {
        document.getElementById('modalDetallePagados').classList.add('oculto');
      });

      // Formularios
      document.getElementById('clienteForm').addEventListener('submit', guardarCliente);
      document.getElementById('btnGuardarCapital').addEventListener('click', guardarCapital);

      // Vista previa de c√°lculos
      const inputs = ['monto', 'margen', 'cuotas'];
      inputs.forEach(input => {
        document.querySelector(`input[name="${input}"]`).addEventListener('input', actualizarVistaPrevia);
      });

      // Filtros
      document.getElementById('searchInput').addEventListener('input', renderizarClientes);
      document.getElementById('filterEstado').addEventListener('change', renderizarClientes);

      // Tema
      document.getElementById('themeToggle').addEventListener('click', toggleTheme);

      // Pesta√±as del modal detalle
      document.querySelectorAll('.detalle-tab').forEach(tab => {
        tab.addEventListener('click', cambiarPanelDetalle);
      });

      // Botones del modal detalle
      document.getElementById('btnEditarCliente').addEventListener('click', editarClienteDetalle);
      document.getElementById('btnEliminarCliente').addEventListener('click', eliminarClienteDetalle);

      // Copiar enlace
      document.getElementById('btnCopyLink').addEventListener('click', copiarEnlace);

      // Eventos para tarjetas clicables del dashboard
      document.getElementById('cardTotalClientes').addEventListener('click', abrirDetalleTotalClientes);
      document.getElementById('cardPendientes').addEventListener('click', abrirDetallePendientes);
      document.getElementById('cardPagados').addEventListener('click', abrirDetallePagados);

      // Cerrar modales al hacer clic fuera
      document.getElementById('formularioCliente').addEventListener('click', (e) => {
        if (e.target === e.currentTarget) cerrarModalCliente();
      });
      document.getElementById('modalCapital').addEventListener('click', (e) => {
        if (e.target === e.currentTarget) cerrarModalCapital();
      });
      document.getElementById('modalDetalleCliente').addEventListener('click', (e) => {
        if (e.target === e.currentTarget) cerrarModalDetalle();
      });
    }

    function cerrarModalCliente() {
      document.getElementById('formularioCliente').classList.add('oculto');
      document.getElementById('clienteForm').reset();
      document.getElementById('calculationPreview').classList.add('oculto');
      const hoy = new Date().toISOString().split('T')[0];
      document.querySelector('input[name="inicio"]').value = hoy;
      clienteEditando = null;
    }

    function cerrarModalCapital() {
      document.getElementById('modalCapital').classList.add('oculto');
    }

    function cerrarModalDetalle() {
      document.getElementById('modalDetalleCliente').classList.add('oculto');
      clienteDetalle = null;
    }

    // Vista previa de c√°lculos
    function actualizarVistaPrevia() {
      const monto = parseFloat(document.querySelector('input[name="monto"]').value) || 0;
      const margen = parseFloat(document.querySelector('input[name="margen"]').value) || 0;
      const cuotas = parseInt(document.querySelector('input[name="cuotas"]').value) || 1;

      if (monto > 0) {
        const ganancia = monto * (margen / 100);
        const total = monto + ganancia;
        const valorCuota = total / cuotas;

        document.getElementById('prevCosto').textContent = `$${monto.toFixed(2)}`;
        document.getElementById('prevMargen').textContent = `$${ganancia.toFixed(2)} (${margen}%)`;
        document.getElementById('prevTotal').textContent = `$${total.toFixed(2)}`;
        document.getElementById('prevCuota').textContent = `$${valorCuota.toFixed(2)}`;
        
        document.getElementById('calculationPreview').classList.remove('oculto');
      } else {
        document.getElementById('calculationPreview').classList.add('oculto');
      }
    }

    // Gesti√≥n de capital
    function guardarCapital() {
      const nuevoCapital = parseFloat(document.getElementById('inputCapitalInicial').value) || 0;
      capital.inicial = nuevoCapital;
      window.capital = capital; // Actualizar variable global
      guardarDatos();
      actualizarCapital();
      cerrarModalCapital();
      mostrarNotificacion('üí∞ Capital actualizado correctamente', 'success');
    }

    function actualizarCapital() {
      const invertido = clientes.reduce((sum, c) => sum + c.monto, 0);
      const disponible = capital.inicial - invertido;
      const gananciaTotal = clientes
        .filter(c => c.estado === 'pagado')
        .reduce((sum, c) => sum + (c.montoTotal - c.monto), 0);

      capital.invertido = invertido;
      window.capital = capital; // Actualizar variable global

      document.getElementById('capitalInicial').textContent = `$${capital.inicial.toFixed(2)}`;
      document.getElementById('capitalInvertido').textContent = `$${invertido.toFixed(2)}`;
      document.getElementById('capitalDisponible').textContent = `$${disponible.toFixed(2)}`;
      document.getElementById('gananciaTotal').textContent = `$${gananciaTotal.toFixed(2)}`;
    }

    // Hacer funciones globales para Firebase
    window.actualizarDashboard = actualizarDashboard;
    window.actualizarCapital = actualizarCapital;
    window.renderizarClientes = renderizarClientes;
    window.mostrarNotificacion = mostrarNotificacion;

    // Guardar cliente (nuevo o editado)
    function guardarCliente(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const clienteData = Object.fromEntries(formData);
      
      // Validar capital disponible solo para clientes nuevos
      const costoProducto = parseFloat(clienteData.monto);
      if (!clienteEditando) {
        const disponible = capital.inicial - capital.invertido;
        if (costoProducto > disponible) {
          mostrarNotificacion(`üí∏ Capital insuficiente. Disponible: $${disponible.toFixed(2)}`, 'error');
          return;
        }
      }
      
      if (clienteEditando) {
        // Editar cliente existente
        const index = clientes.findIndex(c => c.id === clienteEditando.id);
        if (index !== -1) {
          const cliente = clientes[index];
          
          // Actualizar datos b√°sicos
          cliente.nombre = clienteData.nombre;
          cliente.cedula = clienteData.cedula;
          cliente.celular = clienteData.celular;
          cliente.producto = clienteData.producto;
          cliente.monto = costoProducto;
          cliente.margen = parseFloat(clienteData.margen);
          cliente.cuotas = parseInt(clienteData.cuotas);
          cliente.periodo = clienteData.periodo;
          cliente.inicio = clienteData.inicio;
          
          // Recalcular valores
          const ganancia = cliente.monto * (cliente.margen / 100);
          cliente.montoTotal = cliente.monto + ganancia;
          cliente.valorCuota = cliente.montoTotal / cliente.cuotas;
          cliente.ganancia = ganancia;
          
          // Regenerar fechas de cuotas si cambi√≥ el per√≠odo o n√∫mero de cuotas
          if (cliente.cuotas !== cliente.cuotasDetalle.length || 
              cliente.periodo !== clienteEditando.periodo ||
              cliente.inicio !== clienteEditando.inicio) {
            
            cliente.fechasCuotas = generarFechasCuotas(cliente.inicio, cliente.cuotas, cliente.periodo);
            
            // Mantener el estado de las cuotas pagadas existentes
            const cuotasPagadasAnteriores = cliente.cuotasDetalle.filter(c => c.pagada).length;
            cliente.cuotasDetalle = cliente.fechasCuotas.map((fecha, index) => ({
              numero: index + 1,
              fecha: fecha,
              monto: cliente.valorCuota,
              pagada: index < cuotasPagadasAnteriores,
              fechaPago: index < cuotasPagadasAnteriores ? new Date().toISOString() : null
            }));
          } else {
            // Solo actualizar el monto de las cuotas
            cliente.cuotasDetalle.forEach(cuota => {
              cuota.monto = cliente.valorCuota;
            });
          }
          
          mostrarNotificacion('‚úèÔ∏è Cliente actualizado exitosamente', 'success');
        }
      } else {
        // Crear nuevo cliente
        const cliente = {
          id: Date.now(),
          ...clienteData,
          monto: costoProducto,
          margen: parseFloat(clienteData.margen),
          cuotas: parseInt(clienteData.cuotas),
          fechaCreacion: new Date().toISOString(),
          estado: 'pendiente',
          cuotasPagadas: 0
        };
        
        // Calcular valores
        const ganancia = cliente.monto * (cliente.margen / 100);
        cliente.montoTotal = cliente.monto + ganancia;
        cliente.valorCuota = cliente.montoTotal / cliente.cuotas;
        cliente.ganancia = ganancia;
        
        // Generar fechas de cuotas
        cliente.fechasCuotas = generarFechasCuotas(cliente.inicio, cliente.cuotas, cliente.periodo);
        cliente.cuotasDetalle = cliente.fechasCuotas.map((fecha, index) => ({
          numero: index + 1,
          fecha: fecha,
          monto: cliente.valorCuota,
          pagada: false,
          fechaPago: null
        }));
        
        clientes.push(cliente);
        window.clientes = clientes; // Actualizar variable global
        mostrarNotificacion('üë§ Cliente agregado exitosamente', 'success');
      }
      
      guardarDatos();
      actualizarDashboard();
      actualizarCapital();
      renderizarClientes();
      
      cerrarModalCliente();
    }

    // Generar fechas de cuotas
    function generarFechasCuotas(fechaInicio, numCuotas, periodo) {
      const fechas = [];
      const inicio = new Date(fechaInicio);
      const diasPeriodo = periodo === 'semanal' ? 7 : 15;
      
      for (let i = 0; i < numCuotas; i++) {
        const fecha = new Date(inicio);
        fecha.setDate(fecha.getDate() + (i * diasPeriodo));
        fechas.push(fecha.toISOString().split('T')[0]);
      }
      
      return fechas;
    }

    // Renderizar clientes
    function renderizarClientes() {
      const clientesFiltrados = obtenerClientesFiltrados();
      const lista = document.getElementById('listaClientes');
      lista.innerHTML = '';

      clientesFiltrados.forEach(cliente => {
        const progreso = (cliente.cuotasPagadas / cliente.cuotas) * 100;
        const estado = determinarEstado(cliente);
        const proximaCuota = obtenerProximaCuota(cliente);
        
        const div = document.createElement('div');
        div.className = 'cliente-item';
        div.onclick = () => abrirDetalleCliente(cliente.id);
        div.innerHTML = `
          <div class="cliente-header">
            <div class="cliente-info">
              <h4>${cliente.nombre}</h4>
              <p><strong>${cliente.producto}</strong> - $${cliente.valorCuota.toFixed(2)} ${cliente.periodo}</p>
              <p>Progreso: ${cliente.cuotasPagadas}/${cliente.cuotas} (${progreso.toFixed(1)}%)</p>
              <p>Pr√≥xima: ${proximaCuota}</p>
            </div>
            <div class="cliente-actions">
              <span class="cliente-status status-${estado}">${estado.toUpperCase()}</span>
            </div>
          </div>
        `;
        lista.appendChild(div);
      });

      if (clientesFiltrados.length === 0) {
        lista.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--text-muted);">No se encontraron clientes</div>';
      }
    }

    // Abrir detalle del cliente
    function abrirDetalleCliente(clienteId) {
      const cliente = clientes.find(c => c.id === clienteId);
      if (!cliente) return;
      
      clienteDetalle = cliente;
      
      // Actualizar informaci√≥n b√°sica
      document.getElementById('nombreClienteDetalle').textContent = cliente.nombre;
      document.getElementById('detalleNombre').textContent = cliente.nombre;
      document.getElementById('detalleCedula').textContent = cliente.cedula;
      document.getElementById('detalleCelular').textContent = cliente.celular;
      document.getElementById('detalleProducto').textContent = cliente.producto;
      document.getElementById('detalleFechaInicio').textContent = new Date(cliente.inicio).toLocaleDateString('es-ES');
      
      const estado = determinarEstado(cliente);
      document.getElementById('detalleEstado').textContent = estado.toUpperCase();
      document.getElementById('detalleEstado').className = `value status-${estado}`;
      
      // Actualizar informaci√≥n financiera
      document.getElementById('detalleCosto').textContent = `$${cliente.monto.toFixed(2)}`;
      document.getElementById('detalleMargen').textContent = `${cliente.margen}%`;
      document.getElementById('detalleGanancia').textContent = `$${cliente.ganancia.toFixed(2)}`;
      document.getElementById('detalleTotal').textContent = `$${cliente.montoTotal.toFixed(2)}`;
      document.getElementById('detalleValorCuota').textContent = `$${cliente.valorCuota.toFixed(2)}`;
      document.getElementById('detallePeriodo').textContent = cliente.periodo;
      
      // Actualizar progreso
      const progreso = (cliente.cuotasPagadas / cliente.cuotas) * 100;
      document.getElementById('detalleProgreso').textContent = `${cliente.cuotasPagadas}/${cliente.cuotas}`;
      document.getElementById('detallePorcentaje').textContent = `${progreso.toFixed(1)}%`;
      document.getElementById('detalleProgressFill').style.width = `${progreso}%`;
      
      // Renderizar cuotas
      renderizarCuotasDetalle(cliente);
      
      // Renderizar calendario
      renderizarCalendarioDetalle(cliente);
      
      // Mostrar modal
      document.getElementById('modalDetalleCliente').classList.remove('oculto');
    }

    // Renderizar cuotas en el detalle
    function renderizarCuotasDetalle(cliente) {
      const grid = document.getElementById('cuotasGrid');
      grid.innerHTML = '';
      
      const hoy = new Date();
      
      cliente.cuotasDetalle.forEach((cuota, index) => {
        let claseEstado = 'pendiente';
        let icono = '';
        
        if (cuota.pagada) {
          claseEstado = 'pagada';
          icono = '‚úì';
        } else if (new Date(cuota.fecha) < hoy) {
          claseEstado = 'vencida';
          icono = '‚ö†Ô∏è';
        } else if (index === cliente.cuotasPagadas) {
          claseEstado = 'proxima';
          icono = '‚è∞';
        }
        
        const div = document.createElement('div');
        div.className = `cuota-card ${claseEstado}`;
        div.onclick = () => toggleCuotaDetalle(cliente.id, index);
        div.innerHTML = `
          <div>Cuota ${cuota.numero} ${icono}</div>
          <div>$${cuota.monto.toFixed(2)}</div>
          <div>${new Date(cuota.fecha).toLocaleDateString('es-ES')}</div>
        `;
        grid.appendChild(div);
      });
    }

    // Toggle cuota desde el detalle
    function toggleCuotaDetalle(clienteId, cuotaIndex) {
      toggleCuota(clienteId, cuotaIndex);
      
      // Actualizar la vista del detalle
      const cliente = clientes.find(c => c.id === clienteId);
      if (cliente) {
        renderizarCuotasDetalle(cliente);
        
        // Actualizar progreso
        const progreso = (cliente.cuotasPagadas / cliente.cuotas) * 100;
        document.getElementById('detalleProgreso').textContent = `${cliente.cuotasPagadas}/${cliente.cuotas}`;
        document.getElementById('detallePorcentaje').textContent = `${progreso.toFixed(1)}%`;
        document.getElementById('detalleProgressFill').style.width = `${progreso}%`;
      }
    }

    // Renderizar calendario del detalle
    function renderizarCalendarioDetalle(cliente) {
      const calendario = document.getElementById('calendarioMini');
      const hoy = new Date();
      const mesActual = hoy.getMonth();
      const a√±oActual = hoy.getFullYear();
      
      // Crear header del calendario
      const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                    'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
      
      calendario.innerHTML = `
        <div class="calendar-header">
          <h4>${meses[mesActual]} ${a√±oActual}</h4>
        </div>
        <div class="calendar-grid" id="calendarGrid"></div>
      `;
      
      const grid = document.getElementById('calendarGrid');
      
      // D√≠as de la semana
      const diasSemana = ['D', 'L', 'M', 'M', 'J', 'V', 'S'];
      diasSemana.forEach(dia => {
        const div = document.createElement('div');
        div.className = 'calendar-day header';
        div.textContent = dia;
        grid.appendChild(div);
      });
      
      // D√≠as del mes
      const primerDia = new Date(a√±oActual, mesActual, 1);
      const ultimoDia = new Date(a√±oActual, mesActual + 1, 0);
      const diasEnMes = ultimoDia.getDate();
      const diaSemanaInicio = primerDia.getDay();
      
      // Espacios vac√≠os al inicio
      for (let i = 0; i < diaSemanaInicio; i++) {
        const div = document.createElement('div');
        div.className = 'calendar-day';
        grid.appendChild(div);
      }
      
      // D√≠as del mes
      for (let dia = 1; dia <= diasEnMes; dia++) {
        const fecha = new Date(a√±oActual, mesActual, dia);
        const fechaStr = fecha.toISOString().split('T')[0];
        
        const div = document.createElement('div');
        div.className = 'calendar-day';
        div.textContent = dia;
        
        // Marcar d√≠a actual
        if (fecha.toDateString() === hoy.toDateString()) {
          div.classList.add('today');
        }
        
        // Marcar d√≠as con pagos
        const tienePago = cliente.cuotasDetalle.some(cuota => 
          cuota.fecha === fechaStr && cuota.pagada
        );
        const tieneVencimiento = cliente.cuotasDetalle.some(cuota => 
          cuota.fecha === fechaStr && !cuota.pagada
        );
        
        if (tienePago) {
          div.classList.add('has-payment');
        } else if (tieneVencimiento) {
          div.classList.add('has-due');
        }
        
        grid.appendChild(div);
      }
    }

    // Cambiar panel del detalle
    function cambiarPanelDetalle(e) {
      const panelName = e.target.dataset.panel;
      
      // Actualizar pesta√±as activas
      document.querySelectorAll('.detalle-tab').forEach(tab => tab.classList.remove('active'));
      e.target.classList.add('active');
      
      // Mostrar/ocultar paneles
      document.querySelectorAll('.detalle-panel').forEach(panel => panel.classList.remove('active'));
      document.getElementById(`panel${panelName.charAt(0).toUpperCase() + panelName.slice(1)}`).classList.add('active');
    }

    // Editar cliente desde el detalle
    function editarClienteDetalle() {
      if (!clienteDetalle) return;
      
      clienteEditando = clienteDetalle;
      
      // Llenar el formulario con los datos actuales
      document.querySelector('input[name="nombre"]').value = clienteDetalle.nombre;
      document.querySelector('input[name="cedula"]').value = clienteDetalle.cedula;
      document.querySelector('input[name="celular"]').value = clienteDetalle.celular;
      document.querySelector('input[name="producto"]').value = clienteDetalle.producto;
      document.querySelector('input[name="monto"]').value = clienteDetalle.monto;
      document.querySelector('input[name="margen"]').value = clienteDetalle.margen;
      document.querySelector('input[name="cuotas"]').value = clienteDetalle.cuotas;
      document.querySelector('select[name="periodo"]').value = clienteDetalle.periodo;
      document.querySelector('input[name="inicio"]').value = clienteDetalle.inicio;
      
      // Actualizar t√≠tulos
      document.getElementById('tituloFormulario').textContent = 'Editar Cliente';
      document.getElementById('textoBotonGuardar').textContent = 'Actualizar Cliente';
      
      // Actualizar vista previa
      actualizarVistaPrevia();
      
      // Cerrar modal detalle y abrir formulario
      cerrarModalDetalle();
      document.getElementById('formularioCliente').classList.remove('oculto');
    }

    // Eliminar cliente desde el detalle
    function eliminarClienteDetalle() {
      if (!clienteDetalle) return;
      
      if (confirm(`¬øEst√°s seguro de eliminar a ${clienteDetalle.nombre}? Esta acci√≥n no se puede deshacer.`)) {
        clientes = clientes.filter(c => c.id !== clienteDetalle.id);
        window.clientes = clientes; // Actualizar variable global
        guardarDatos();
        actualizarDashboard();
        actualizarCapital();
        renderizarClientes();
        cerrarModalDetalle();
        mostrarNotificacion('üóëÔ∏è Cliente eliminado correctamente', 'success');
      }
    }

    // Toggle cuota
    function toggleCuota(clienteId, cuotaIndex) {
      const cliente = clientes.find(c => c.id === clienteId);
      if (!cliente) return;
      
      const cuota = cliente.cuotasDetalle[cuotaIndex];
      
      // Solo permitir pagar cuotas en orden
      if (!cuota.pagada && cuotaIndex !== cliente.cuotasPagadas) {
        mostrarNotificacion('‚ö†Ô∏è Debe pagar las cuotas en orden', 'warning');
        return;
      }
      
      if (cuota.pagada) {
        // Despagar cuota (solo si es la √∫ltima pagada)
        if (cuotaIndex === cliente.cuotasPagadas - 1) {
          cuota.pagada = false;
          cuota.fechaPago = null;
          cliente.cuotasPagadas--;
        } else {
          mostrarNotificacion('‚ö†Ô∏è Solo puede despagar la √∫ltima cuota pagada', 'warning');
          return;
        }
      } else {
        // Pagar cuota
        cuota.pagada = true;
        cuota.fechaPago = new Date().toISOString();
        cliente.cuotasPagadas++;
      }
      
      // Actualizar estado del cliente
      if (cliente.cuotasPagadas === cliente.cuotas) {
        cliente.estado = 'pagado';
      } else {
        cliente.estado = 'pendiente';
      }
      
      window.clientes = clientes; // Actualizar variable global
      guardarDatos();
      actualizarDashboard();
      actualizarCapital();
      renderizarClientes();
      
      const accion = cuota.pagada ? 'marcada como pagada' : 'marcada como pendiente';
      mostrarNotificacion(`üí≥ Cuota ${cuota.numero} ${accion}`, 'success');
    }

    // Obtener clientes filtrados
    function obtenerClientesFiltrados() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const filterEstado = document.getElementById('filterEstado').value;
      
      return clientes.filter(cliente => {
        const matchSearch = cliente.nombre.toLowerCase().includes(searchTerm) ||
                           cliente.cedula.includes(searchTerm) ||
                           cliente.producto.toLowerCase().includes(searchTerm);
        
        const estado = determinarEstado(cliente);
        const matchFilter = filterEstado === 'all' || estado === filterEstado;
        
        return matchSearch && matchFilter;
      });
    }

    // Determinar estado del cliente
    function determinarEstado(cliente) {
      if (cliente.cuotasPagadas === cliente.cuotas) {
        return 'pagado';
      }
      
      // Verificar si tiene cuotas vencidas
      const hoy = new Date();
      const proximaCuotaIndex = cliente.cuotasPagadas;
      
      if (proximaCuotaIndex < cliente.cuotasDetalle.length) {
        const proximaCuotaFecha = new Date(cliente.cuotasDetalle[proximaCuotaIndex].fecha);
        if (proximaCuotaFecha < hoy) {
          return 'vencido';
        }
      }
      
      return 'pendiente';
    }

    // Obtener pr√≥xima cuota
    function obtenerProximaCuota(cliente) {
      if (cliente.cuotasPagadas >= cliente.cuotas) {
        return 'Completado';
      }
      
      const proximaCuota = cliente.cuotasDetalle[cliente.cuotasPagadas];
      return new Date(proximaCuota.fecha).toLocaleDateString('es-ES');
    }

    // Actualizar dashboard
    function actualizarDashboard() {
      const totalClientes = clientes.length;
      const clientesPendientes = clientes.filter(c => determinarEstado(c) === 'pendiente');
      const clientesPagados = clientes.filter(c => c.estado === 'pagado');
      
      const totalPendiente = clientesPendientes.reduce((sum, c) => {
        const cuotasPendientes = c.cuotas - c.cuotasPagadas;
        return sum + (cuotasPendientes * c.valorCuota);
      }, 0);
      
      const totalPagado = clientesPagados.reduce((sum, c) => sum + c.montoTotal, 0);
      
      // Pr√≥xima cuota m√°s cercana
      let proximaCuota = '‚Äì';
      const hoy = new Date();
      const fechasProximas = [];
      
      clientesPendientes.forEach(cliente => {
        if (cliente.cuotasPagadas < cliente.cuotas) {
          const proximaFecha = new Date(cliente.cuotasDetalle[cliente.cuotasPagadas].fecha);
          if (proximaFecha >= hoy) {
            fechasProximas.push(proximaFecha);
          }
        }
      });
      
      if (fechasProximas.length > 0) {
        const fechaMasCercana = new Date(Math.min(...fechasProximas));
        proximaCuota = fechaMasCercana.toLocaleDateString('es-ES');
      }

      document.getElementById('totalClientes').textContent = totalClientes;
      document.getElementById('totalPendiente').textContent = `$${totalPendiente.toFixed(2)}`;
      document.getElementById('totalPagado').textContent = `$${totalPagado.toFixed(2)}`;
      document.getElementById('proxCuota').textContent = proximaCuota;
    }

    // Toggle tema
    function toggleTheme() {
      // En este dise√±o mantenemos el tema oscuro fijo
      mostrarNotificacion('üé® Tema optimizado para FRIFRI', 'info');
    }

    // Copiar enlace
    function copiarEnlace() {
      const input = document.getElementById('shareUrl');
      if (input.value) {
        input.select();
        document.execCommand('copy');
        mostrarNotificacion('üìã Enlace copiado al portapapeles', 'success');
      } else {
        mostrarNotificacion('‚ö†Ô∏è Primero necesitas conexi√≥n WiFi', 'warning');
      }
    }

    // Mostrar notificaci√≥n
    function mostrarNotificacion(mensaje, tipo = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification ${tipo} show`;
      notification.textContent = mensaje;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }

    // Abrir reporte de ganancias
    function abrirReporteGanancias() {
      const clientesPagados = clientes.filter(c => c.estado === 'pagado');
      const gananciasGeneradas = clientes
        .filter(c => c.estado === 'pagado')
        .reduce((sum, c) => sum + (c.montoTotal - c.monto), 0);
      
      const gananciasProyectadas = clientes
        .filter(c => c.estado !== 'pagado')
        .reduce((sum, c) => sum + (c.montoTotal - c.monto), 0);

      const content = document.getElementById('reporteGananciasContent');
      content.innerHTML = `
        <div class="info-grid">
          <div class="info-item">
            <div class="label">Ganancias Realizadas</div>
            <div class="value" style="color: var(--success); font-size: 1.5rem; font-weight: 700;">$${gananciasGeneradas.toFixed(2)}</div>
          </div>
          <div class="info-item">
            <div class="label">Ganancias Proyectadas</div>
            <div class="value" style="color: var(--warning); font-size: 1.5rem; font-weight: 700;">$${gananciasProyectadas.toFixed(2)}</div>
          </div>
          <div class="info-item">
            <div class="label">Total Potencial</div>
            <div class="value" style="color: var(--primary); font-size: 1.5rem; font-weight: 700;">$${(gananciasGeneradas + gananciasProyectadas).toFixed(2)}</div>
          </div>
          <div class="info-item">
            <div class="label">Clientes Completados</div>
            <div class="value">${clientesPagados.length} de ${clientes.length}</div>
          </div>
        </div>
        
        <h4 style="margin: 1rem 0 0.5rem 0; color: var(--text);">Detalle por Cliente Completado:</h4>
        <div style="max-height: 300px; overflow-y: auto;">
          ${clientesPagados.map(cliente => `
            <div style="background: var(--bg); padding: 0.75rem; border-radius: 0.375rem; margin-bottom: 0.5rem; border: 1px solid var(--border);">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <strong>${cliente.nombre}</strong><br>
                  <small style="color: var(--text-muted);">${cliente.producto}</small>
                </div>
                <div style="text-align: right;">
                  <div style="color: var(--success); font-weight: 600;">+$${(cliente.montoTotal - cliente.monto).toFixed(2)}</div>
                  <small style="color: var(--text-muted);">${cliente.margen}% ganancia</small>
                </div>
              </div>
            </div>
          `).join('')}
        </div>
      `;
      
      document.getElementById('modalReporteGanancias').classList.remove('oculto');
    }

    // Abrir reporte de gastos
    function abrirReporteGastos() {
      const totalInvertido = clientes.reduce((sum, c) => sum + c.monto, 0);
      const gastosOperativos = capital.inicial * 0.05; // Estimado 5% gastos operativos
      const totalGastos = totalInvertido + gastosOperativos;

      const content = document.getElementById('reporteGastosContent');
      content.innerHTML = `
        <div class="info-grid">
          <div class="info-item">
            <div class="label">Capital Invertido</div>
            <div class="value" style="color: var(--danger); font-size: 1.5rem; font-weight: 700;">$${totalInvertido.toFixed(2)}</div>
          </div>
          <div class="info-item">
            <div class="label">Gastos Operativos (Est.)</div>
            <div class="value" style="color: var(--warning); font-size: 1.5rem; font-weight: 700;">$${gastosOperativos.toFixed(2)}</div>
          </div>
          <div class="info-item">
            <div class="label">Total Gastos</div>
            <div class="value" style="color: var(--danger); font-size: 1.5rem; font-weight: 700;">$${totalGastos.toFixed(2)}</div>
          </div>
          <div class="info-item">
            <div class="label">Capital Disponible</div>
            <div class="value" style="color: ${(capital.inicial - totalInvertido) >= 0 ? 'var(--success)' : 'var(--danger)'}; font-size: 1.5rem; font-weight: 700;">$${(capital.inicial - totalInvertido).toFixed(2)}</div>
          </div>
        </div>
        
        <h4 style="margin: 1rem 0 0.5rem 0; color: var(--text);">Detalle de Inversiones:</h4>
        <div style="max-height: 300px; overflow-y: auto;">
          ${clientes.map(cliente => `
            <div style="background: var(--bg); padding: 0.75rem; border-radius: 0.375rem; margin-bottom: 0.5rem; border: 1px solid var(--border);">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <strong>${cliente.nombre}</strong><br>
                  <small style="color: var(--text-muted);">${cliente.producto}</small>
                </div>
                <div style="text-align: right;">
                  <div style="color: var(--danger); font-weight: 600;">-$${cliente.monto.toFixed(2)}</div>
                  <small style="color: var(--text-muted);">Inversi√≥n inicial</small>
                </div>
              </div>
            </div>
          `).join('')}
        </div>
      `;
      
      document.getElementById('modalReporteGastos').classList.remove('oculto');
    }

    // Abrir detalle total clientes
    function abrirDetalleTotalClientes() {
      const clientesPorEstado = {
        pendiente: clientes.filter(c => determinarEstado(c) === 'pendiente').length,
        pagado: clientes.filter(c => c.estado === 'pagado').length,
        vencido: clientes.filter(c => determinarEstado(c) === 'vencido').length
      };

      const content = document.getElementById('detalleTotalClientesContent');
      content.innerHTML = `
        <div class="info-grid">
          <div class="info-item">
            <div class="label">Total Clientes</div>
            <div class="value" style="color: var(--primary); font-size: 2rem; font-weight: 700;">${clientes.length}</div>
          </div>
          <div class="info-item">
            <div class="label">Clientes Activos</div>
            <div class="value" style="color: var(--warning);">${clientesPorEstado.pendiente}</div>
          </div>
          <div class="info-item">
            <div class="label">Clientes Completados</div>
            <div class="value" style="color: var(--success);">${clientesPorEstado.pagado}</div>
          </div>
          <div class="info-item">
            <div class="label">Clientes Vencidos</div>
            <div class="value" style="color: var(--danger);">${clientesPorEstado.vencido}</div>
          </div>
        </div>
        
        <h4 style="margin: 1rem 0 0.5rem 0; color: var(--text);">Lista Completa de Clientes:</h4>
        <div style="max-height: 300px; overflow-y: auto;">
          ${clientes.map(cliente => {
            const estado = determinarEstado(cliente);
            const progreso = (cliente.cuotasPagadas / cliente.cuotas) * 100;
            return `
              <div style="background: var(--bg); padding: 0.75rem; border-radius: 0.375rem; margin-bottom: 0.5rem; border: 1px solid var(--border);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <div>
                    <strong>${cliente.nombre}</strong><br>
                    <small style="color: var(--text-muted);">${cliente.producto} - ${cliente.cuotasPagadas}/${cliente.cuotas} cuotas</small>
                  </div>
                  <div style="text-align: right;">
                    <span class="cliente-status status-${estado}" style="padding: 0.25rem 0.5rem; border-radius: 0.75rem; font-size: 0.625rem; font-weight: 600;">${estado.toUpperCase()}</span><br>
                    <small style="color: var(--text-muted);">${progreso.toFixed(1)}% completado</small>
                  </div>
                </div>
              </div>
            `;
          }).join('')}
        </div>
      `;
      
      document.getElementById('modalDetalleTotalClientes').classList.remove('oculto');
    }

    // Abrir detalle pendientes
    function abrirDetallePendientes() {
      const clientesPendientes = clientes.filter(c => determinarEstado(c) === 'pendiente' || determinarEstado(c) === 'vencido');
      const totalPendiente = clientesPendientes.reduce((sum, c) => {
        const cuotasPendientes = c.cuotas - c.cuotasPagadas;
        return sum + (cuotasPendientes * c.valorCuota);
      }, 0);

      const content = document.getElementById('detallePendientesContent');
      content.innerHTML = `
        <div class="info-grid">
          <div class="info-item">
            <div class="label">Clientes Pendientes</div>
            <div class="value" style="color: var(--warning); font-size: 2rem; font-weight: 700;">${clientesPendientes.length}</div>
          </div>
          <div class="info-item">
            <div class="label">Monto Total Pendiente</div>
            <div class="value" style="color: var(--warning); font-size: 1.5rem; font-weight: 700;">$${totalPendiente.toFixed(2)}</div>
          </div>
          <div class="info-item">
            <div class="label">Promedio por Cliente</div>
            <div class="value">$${clientesPendientes.length > 0 ? (totalPendiente / clientesPendientes.length).toFixed(2) : '0.00'}</div>
          </div>
          <div class="info-item">
            <div class="label">Cuotas Pendientes</div>
            <div class="value">${clientesPendientes.reduce((sum, c) => sum + (c.cuotas - c.cuotasPagadas), 0)}</div>
          </div>
        </div>
        
        <h4 style="margin: 1rem 0 0.5rem 0; color: var(--text);">Detalle de Clientes Pendientes:</h4>
        <div style="max-height: 300px; overflow-y: auto;">
          ${clientesPendientes.map(cliente => {
            const estado = determinarEstado(cliente);
            const cuotasPendientes = cliente.cuotas - cliente.cuotasPagadas;
            const montoPendiente = cuotasPendientes * cliente.valorCuota;
            const proximaCuota = obtenerProximaCuota(cliente);
            return `
              <div style="background: var(--bg); padding: 0.75rem; border-radius: 0.375rem; margin-bottom: 0.5rem; border: 1px solid var(--border);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <div>
                    <strong>${cliente.nombre}</strong><br>
                    <small style="color: var(--text-muted);">${cliente.producto}</small><br>
                    <small style="color: var(--text-muted);">Pr√≥xima: ${proximaCuota}</small>
                  </div>
                  <div style="text-align: right;">
                    <div style="color: var(--warning); font-weight: 600;">$${montoPendiente.toFixed(2)}</div>
                    <small style="color: var(--text-muted);">${cuotasPendientes} cuotas restantes</small><br>
                    <span class="cliente-status status-${estado}" style="padding: 0.25rem 0.5rem; border-radius: 0.75rem; font-size: 0.625rem; font-weight: 600;">${estado.toUpperCase()}</span>
                  </div>
                </div>
              </div>
            `;
          }).join('')}
        </div>
      `;
      
      document.getElementById('modalDetallePendientes').classList.remove('oculto');
    }

    // Abrir detalle pagados
    function abrirDetallePagados() {
      const clientesPagados = clientes.filter(c => c.estado === 'pagado');
      const totalPagado = clientesPagados.reduce((sum, c) => sum + c.montoTotal, 0);
      const gananciasRealizadas = clientesPagados.reduce((sum, c) => sum + (c.montoTotal - c.monto), 0);

      const content = document.getElementById('detallePagadosContent');
      content.innerHTML = `
        <div class="info-grid">
          <div class="info-item">
            <div class="label">Clientes Completados</div>
            <div class="value" style="color: var(--success); font-size: 2rem; font-weight: 700;">${clientesPagados.length}</div>
          </div>
          <div class="info-item">
            <div class="label">Total Recaudado</div>
            <div class="value" style="color: var(--success); font-size: 1.5rem; font-weight: 700;">$${totalPagado.toFixed(2)}</div>
          </div>
          <div class="info-item">
            <div class="label">Ganancias Realizadas</div>
            <div class="value" style="color: var(--success); font-size: 1.5rem; font-weight: 700;">$${gananciasRealizadas.toFixed(2)}</div>
          </div>
          <div class="info-item">
            <div class="label">Promedio por Cliente</div>
            <div class="value">$${clientesPagados.length > 0 ? (totalPagado / clientesPagados.length).toFixed(2) : '0.00'}</div>
          </div>
        </div>
        
        <h4 style="margin: 1rem 0 0.5rem 0; color: var(--text);">Detalle de Clientes Completados:</h4>
        <div style="max-height: 300px; overflow-y: auto;">
          ${clientesPagados.map(cliente => {
            const ganancia = cliente.montoTotal - cliente.monto;
            const fechaCompletion = cliente.cuotasDetalle[cliente.cuotasDetalle.length - 1]?.fechaPago;
            return `
              <div style="background: var(--bg); padding: 0.75rem; border-radius: 0.375rem; margin-bottom: 0.5rem; border: 1px solid var(--border);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <div>
                    <strong>${cliente.nombre}</strong><br>
                    <small style="color: var(--text-muted);">${cliente.producto}</small><br>
                    <small style="color: var(--text-muted);">Completado: ${fechaCompletion ? new Date(fechaCompletion).toLocaleDateString('es-ES') : 'N/A'}</small>
                  </div>
                  <div style="text-align: right;">
                    <div style="color: var(--success); font-weight: 600;">$${cliente.montoTotal.toFixed(2)}</div>
                    <small style="color: var(--success);">+$${ganancia.toFixed(2)} ganancia</small><br>
                    <span class="cliente-status status-pagado" style="padding: 0.25rem 0.5rem; border-radius: 0.75rem; font-size: 0.625rem; font-weight: 600;">COMPLETADO</span>
                  </div>
                </div>
              </div>
            `;
          }).join('')}
        </div>
      `;
      
      document.getElementById('modalDetallePagados').classList.remove('oculto');
    }

    // Guardar datos
    function guardarDatos() {
      localStorage.setItem('frifri-clientes', JSON.stringify(clientes));
      localStorage.setItem('frifri-capital', JSON.stringify(capital));
      localStorage.setItem('frifri-last-update', Date.now().toString());
    }
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96c1b97b226167e0',t:'MTc1NDY4NDUzMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
